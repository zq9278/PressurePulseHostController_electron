<!doctype html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=2560, initial-scale=1.0" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self'" />
    <meta name="color-scheme" content="dark" />
    <title>睑板腺热脉冲控制中心</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body class="view-home">
    <script>
      (function() {
        const params = new URLSearchParams(window.location.search || '');
        let debugWeb = params.has('debugWeb');
        const debugMouse = params.has('debugMouse') || debugWeb || location.protocol.startsWith('http');
        if (!window.api) {
          debugWeb = true; // fallback to stub when no electron preload
        }
        window.__PPHC_WEBDEBUG__ = debugWeb;
        if (debugWeb) {
          document.documentElement.classList.add('debug-web');
        }
        if (debugMouse) {
          document.documentElement.classList.add('debug-mouse');
        }
        if (!window.api) {
          const noop = () => {};
          window.api = {
            listPorts: async () => [],
            connect: async () => false,
            disconnect: async () => {},
            sendU8: noop,
            sendF32: noop,
            sendU16: noop,
            sendU32: noop,
            sendText: noop,
            exitApp: noop,
            getBrightness: async () => ({ percent: 80, raw: 0, max: 255 }),
            setBrightness: async () => ({ percent: 80, raw: 0, max: 255 }),
            onSerialData: () => {},
            onConnectionChanged: () => {},
            onHeartbeatAck: () => {},
            onSystemState: () => {},
            onAlarmState: () => {},
            onModeCurves: () => {},
            onStopTreatment: () => {},
            onShieldState: () => {},
          };
        }
      })();
    </script>
    <div class="bg-board"></div>
    <div class="app-shell" data-view="home">
      <div class="window-controls">
        <button id="btnExit" class="ghost exit-button">退出程序</button>
      </div>
      <section id="homeScreen" class="screen home-screen">
        <div class="hero-backdrop">
          <div class="hero-glow hero-glow-left"></div>
          <div class="hero-glow hero-glow-right"></div>
          <div class="hero-grid">
            <div class="hero-blade"></div>
            <div class="hero-content">
              <div class="hero-clock" id="heroClock">2025/09/16 15:30</div>
              <div class="hero-nameplate">
                <div class="hero-logo" aria-label="九辰医疗 9C-U-TPS">
                  <img src="../resoure/logo.png" alt="九辰医疗标志" />
                  <div class="hero-logo-text">
                    <strong>九辰医疗</strong>
                    <span>NINESTARS</span>
                  </div>
                </div>
                <div class="hero-codename">9C-U-TPS</div>
              </div>
              <div class="hero-text">
                <h1>眼板腺热脉动治疗仪</h1>
                <p class="hero-subtitle">Thermal Pulsation System</p>
                <p class="hero-desc">面向干眼诊疗的恒温恒压热脉动平台，融合九辰医疗 9C-U-TPS 研发经验与安全控制实力。</p>
              </div>
              <div class="hero-actions-home">
                <button id="btnHomeDevice" class="hero-btn secondary">
                  <span class="label">设置</span>
                  <small>Device Settings</small>
                </button>
                <button id="btnHomeQuick" class="hero-btn primary">
                  <span class="label">快速治疗</span>
                  <small>Start Session</small>
                </button>
              </div>
            </div>
            <div class="hero-eye-texture">
              <div class="hero-eye-core"></div>
              <div class="hero-eye-ring hero-eye-ring-outer"></div>
              <div class="hero-eye-ring hero-eye-ring-inner"></div>
              <div class="hero-eye-scan"></div>
            </div>
          </div>
        </div>
      </section>

      
      <section id="quickScreen" class="screen quick-screen">
        <div class="quick-container">
          <header class="top-bar">
            <button id="btnBackHome" class="icon-back" aria-label="返回主界面"><span>←</span></button>
            <div class="section-title">快速治疗</div>
            <div class="top-placeholder"></div>
          </header>

          <div class="quick-grid">
            <div class="telemetry-area">
              <div class="surface summary-panel">
                <div class="panel-headline">
                  <div>
                    <div class="panel-overline">实时读数</div>
                    <div class="panel-title">压力 / 温度</div>
                  </div>
                  <div class="live-chip">实时刷新</div>
                  <div class="live-chip stage-chip stage-idle" id="modeStageChip">
                    <span class="stage-eyebrow">当前阶段</span>
                    <div class="stage-main">
                      <span class="stage-orb"></span>
                      <span class="stage-label">待机</span>
                    </div>
                  </div>
                </div>
                <div class="circle-readings">
                  <div class="reading-circle" data-side="left">
                    <div class="ring"></div>
                    <div class="circle-core">
                    <div class="circle-label">左眼</div>
                    <div class="circle-value">
                        <span id="pressureLeft">0.0</span>
                        <small>mmHg</small>
                    </div>
                    <div class="circle-temp">
                      <span>温度</span>
                      <strong id="tempLeft">--.-℃</strong>
                    </div>
                    </div>
                  </div>
                  <div class="reading-circle" data-side="right">
                    <div class="ring"></div>
                    <div class="circle-core">
                    <div class="circle-label">右眼</div>
                    <div class="circle-value">
                        <span id="pressureRight">0.0</span>
                        <small>mmHg</small>
                    </div>
                    <div class="circle-temp">
                      <span>温度</span>
                      <strong id="tempRight">--.-℃</strong>
                    </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="surface curve-panel">
                <div class="panel-headline">
                  <div>
                    <div class="panel-overline">实时曲线</div>
                    <div class="panel-title">波形监控</div>
                  </div>
                  <div class="curve-legend">
                    <span class="legend pressure-left">左眼压力</span>
                    <span class="legend pressure-right">右眼压力</span>
                    <span class="legend temp-left">左眼温度</span>
                    <span class="legend temp-right">右眼温度</span>
                  </div>
                </div>
                <div class="curve-grid">
                  <div class="curve-card pressure">
                    <div class="curve-head">
                      <div>左眼压力</div>
                      <div id="pressureLeftLabel">0.0 mmHg</div>
                    </div>
                    <canvas id="sparkPressureLeft" width="1024" height="260"></canvas>
                  </div>
                  <div class="curve-card pressure">
                    <div class="curve-head">
                      <div>右眼压力</div>
                      <div id="pressureRightLabel">0.0 mmHg</div>
                    </div>
                    <canvas id="sparkPressureRight" width="1024" height="260"></canvas>
                  </div>
                  <div class="curve-card temp">
                    <div class="curve-head">
                      <div>左侧温度</div>
                      <div id="tempLeftLabel">--.-℃</div>
                    </div>
                    <canvas id="sparkTempLeft" width="1024" height="260"></canvas>
                  </div>
                  <div class="curve-card temp">
                    <div class="curve-head">
                      <div>右侧温度</div>
                      <div id="tempRightLabel">--.-℃</div>
                    </div>
                    <canvas id="sparkTempRight" width="1024" height="260"></canvas>
                  </div>
                </div>
              </div>
            </div>

            <div class="side-area">
              <div class="surface shield-panel">
                <div class="panel-title">眼盾状态</div>
                <div class="shield-grid">
                  <div class="shield-tile" id="shieldLeft">
                    <div class="tile-header">
                      <span class="eye-label">左眼</span>
                      <span class="chip state" id="shieldLeftState">未在线</span>
                    </div>
                    <div class="tile-body">
                      <div class="meta-row"><span>存在</span><strong id="shieldLeftPresent">--</strong></div>
                      <div class="meta-row"><span>熔断</span><strong id="shieldLeftFuse">--</strong></div>
                    </div>
                  </div>
                  <div class="shield-tile" id="shieldRight">
                    <div class="tile-header">
                      <span class="eye-label">右眼</span>
                      <span class="chip state" id="shieldRightState">未在线</span>
                    </div>
                    <div class="tile-body">
                      <div class="meta-row"><span>存在</span><strong id="shieldRightPresent">--</strong></div>
                      <div class="meta-row"><span>熔断</span><strong id="shieldRightFuse">--</strong></div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="surface treatment-panel">
                <div class="panel-headline">
                  <div>
                    <div class="panel-overline">治疗参数</div>
                    <div class="panel-title">快速调节</div>
                  </div>
                  <div class="panel-note">连接设备后可启动</div>
                </div>
                <div class="control-stack">
                  <div class="slider-card" data-kind="pressure">
                    <div class="slider-head">
                      <div>
                        <div class="eyebrow">治疗压力</div>
                        <strong>目标值 (mmHg)</strong>
                      </div>
                      <div class="slider-value" id="pressMmHgValue">250 mmHg</div>
                    </div>
                    <input type="range" id="pressMmHg" min="150" max="350" step="100" value="250" />
                    <div class="slider-scale">
                      <span>150</span>
                      <span>250</span>
                      <span>350</span>
                    </div>
                  </div>
                  <div class="slider-card" data-kind="duration">
                    <div class="slider-head">
                      <div>
                        <div class="eyebrow">治疗时长</div>
                        <strong>以分钟为单位</strong>
                      </div>
                      <div class="duration-values">
                        <span class="target-duration" id="durationValue">10 min</span>
                        <span class="countdown-chip" id="countdown">10:00</span>
                      </div>
                    </div>
                    <input type="range" id="treatDuration" min="1" max="15" step="1" value="10" />
                    <div class="slider-scale">
                      <span>1</span>
                      <span>5</span>
                      <span>10</span>
                      <span>15</span>
                    </div>
                  </div>
                </div>
                <div class="action-cluster">
                  <button id="btnStartStop" class="action primary-toggle" disabled>开始</button>
                </div>
              </div>

              <div class="surface info-panel">
                <div class="panel-title">系统状态</div>
                <div class="info-grid wide">
                  <div>
                    <div class="label">治疗状态</div>
                    <div id="runState" class="value-chip muted">待命</div>
                  </div>
                  <div>
                    <div class="label">告警</div>
                    <div id="alarmState" class="value-chip muted">--</div>
                  </div>
                  <div>
                    <div class="label">系统状态</div>
                    <div id="systemState" class="value-chip muted">--</div>
                  </div>
                  <div>
                    <div class="label">连接状态</div>
                    <div id="connectionState" class="value-chip muted">未连接</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="settingsScreen" class="screen settings-screen">
        <div class="settings-container">
          <header class="top-bar">
            <button id="btnBackSettings" class="icon-back" aria-label="返回主页"><span>←</span></button>
            <div class="section-title">系统设置</div>
            <div class="top-placeholder"></div>
          </header>

          <div class="settings-layout">
            <aside class="settings-sidebar">
              <div class="sidebar-title">偏好选项</div>
              <div class="settings-nav">
                <button type="button">显示 <span class="hint">亮度 / 屏保</span></button>
                <button type="button">声音 <span class="hint">音量 / 提示</span></button>
                <button type="button">语言 <span class="hint">中文 / English</span></button>
                <button type="button">关于 <span class="hint">版本 / 日志</span></button>
              </div>
            </aside>

            <div class="settings-main">
              <div class="settings-card headered">
                <h3>显示</h3>
                <p class="display-desc">模仿 macOS 样式的柔和背光与模糊效果。</p>
                <div class="setting-row">
                  <div class="meta">
                    <strong>屏幕亮度</strong>
                    <span>调整 UI 辉度</span>
                  </div>
                  <div class="pill"><span>当前</span><strong id="settingsBrightnessValue">80%</strong></div>
                </div>
                <input type="range" class="mac-slider" id="settingsBrightness" min="0" max="100" step="1" />
                <div class="setting-row">
                  <div class="meta">
                    <strong>屏保等待</strong>
                    <span>自动进入屏保的倒计时</span>
                  </div>
                  <div class="pill"><span>倒计时</span><strong id="screensaverValue">10 min</strong></div>
                </div>
                <select id="screensaverSelect">
                  <option value="5">5 分钟</option>
                  <option value="10">10 分钟</option>
                  <option value="15">15 分钟</option>
                  <option value="30">30 分钟</option>
                  <option value="60">60 分钟</option>
                </select>
              </div>

              <div class="settings-stack">
                <div class="settings-card">
                  <h3>声音</h3>
                  <div class="setting-row">
                    <div class="meta">
                      <strong>系统音量</strong>
                      <span>播放提示与反馈</span>
                    </div>
                    <div class="pill"><span>当前</span><strong id="settingsVolumeValue">60%</strong></div>
                  </div>
                  <input type="range" class="mac-slider" id="settingsVolume" min="0" max="100" step="1" />
                  <div class="setting-row">
                    <div class="meta">
                      <strong>提示音</strong>
                      <span>重要操作播放提示</span>
                    </div>
                    <label class="toggle">
                      <input type="checkbox" id="chimeToggle" />
                      <span class="toggle-track"></span>
                    </label>
                  </div>
                </div>

                <div class="settings-card">
                  <h3>语言</h3>
                  <p>中英文切换，实时调整界面文案。</p>
                  <div class="setting-row">
                    <div class="meta">
                      <strong>界面语言</strong>
                      <span>偏好选择</span>
                    </div>
                    <div class="pill"><span>当前</span><strong id="languageValue">中文</strong></div>
                  </div>
                  <div class="radio-pill">
                    <label>
                      <input type="radio" name="lang" id="languageZh" value="zh" checked />
                      <span>中文</span>
                    </label>
                    <label>
                      <input type="radio" name="lang" id="languageEn" value="en" />
                      <span>English</span>
                    </label>
                  </div>
                </div>

                <div class="settings-card">
                  <h3>关于 / 日志</h3>
                  <div class="settings-meta">
                    <div class="meta-tile">
                      <div class="label">程序版本</div>
                      <div class="value" id="settingsAppVersion">0.1.0</div>
                    </div>
                    <div class="meta-tile">
                      <div class="label">固件版本</div>
                      <div class="value" id="settingsFirmwareVersion">--</div>
                    </div>
                  </div>
                  <div class="settings-actions">
                    <button id="btnCheckUpdates" class="ghost-btn">检查更新</button>
                    <button id="btnOpenLogs" class="ghost-btn">打开日志</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>


    </div>

    <div id="alertBanner" class="alert" hidden></div>

    <div id="shieldModal" class="modal" hidden>
      <div class="modal-body">
        <div class="modal-title">眼盾未就绪</div>
        <p id="shieldModalText">请确认左右眼盾均已插入并保持良好接触。</p>
        <button id="modalClose" class="action start">知道了</button>
      </div>
    </div>

    <div id="shieldLostModal" class="modal" hidden>
      <div class="modal-body">
        <div class="modal-title">??????????</div>
        <p>???????????????????????????????????</p>
        <button id="shieldLostBack" class="action start">????</button>
      </div>
    </div>

    <div id="shieldConfirm" class="modal" hidden>
      <div class="modal-body">
        <div class="modal-title" id="shieldConfirmTitle">仅左眼盾在线</div>
        <p id="shieldConfirmText">检测到仅左通道可用，是否继续治疗？</p>
        <div class="modal-actions">
          <button id="confirmCancel" class="action subtle">取消</button>
          <button id="confirmContinue" class="action start">继续</button>
        </div>
      </div>
    </div>

    <script src="main.js"></script>
  </body>
</html>
